# 项目设计与实现细节

## 1-3 期功能

### 实现服务端与客户端的连接, 能响应客户端的简单命令.

* 进入对应目录
* 列出目录下的文件
* 下载目录下的文件
* 上传目录下的文件
* 删除目录下的文件
* 显示当前目录

设计思路: 使用线程池响应客户端.

### 用户注册与登录

使用 sha512 算法保存用户密码密文.

客户端将密码通过 RSA 算法使用公钥加密后发送至服务端, 服务端使用私钥解密后使用 sha512 算法生成密文并与数据库中存储的密文对比验证.

在任何情况下, 都不将用户密码明文保存至磁盘.

### 日志记录

在客户端连接及操作时进行日志记录.

### 断点续传

在比对已传输部分 md5 校验码相同的情况下, 实现文件的断点续传.

### 使用 mmap 进行文件传递

在要传输的文件较大时, 使用 mmap 以提高传输效率.

### 虚拟文件系统

建立虚拟文件系统, 在不同的用户使用相同文件时节省磁盘空间, 并借此在文件上传时实现秒传功能.

## 4 期功能

### 实现长短命令分离

根据所需响应时间不同, 命令可分为以下两种:

* 长命令: 响应时间长, 如下载/上传文件.
* 短命令: 响应时间短, 如进入目录/显示当前目录下的文件等.

在服务端使用主线程响应所有连接的短命令, 用子线程响应长命令.

在客户端使用主线程响应短命令, 在需要使用长命令时, 拉起新线程异步执行.

由于这种设计在进行下载/上传文件时需要使用双方的子线程建立新的连接, 因此可以考虑使用 TOKEN 验证机制. 出于安全性考虑, 还应考虑 token 的加密机制.

### 实现长时间无操作时自动断开

当客户端长时间无操作时, 服务端应当自动断开以回收资源.

通过轮盘法实现服务端的自动断开.

具体设计细节留待考虑.
