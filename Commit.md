# 提交历史

### V 4.0 alpha

#### 2205141754

- 完成了程序自检与初始化部分的功能, 包括: 配置文件初始化, rsa 密钥对初始化, MySQL 数据库连接初始化, 线程池初始化, tcp 初始化与日志初始化.

- 完成了主线程处理函数除消息处理之外的其他功能. 完成部分主要是主线程功能的初始化与运行, 如与客户端的连接与断开, 以及时间轮定时器的功能等.

- 能够与客户端建立连接, 能够简单接受来自客户端的部分请求消息并分辨其类型. 但详细的通信协议尚未完善.

### V 4.1 alpha

#### 2205151140

- 实现了下发验证请求中随机字符串的生成.

- 更新了开发手册中的协议设计.

- 更新了部分代码注释.

##### 2205151148

- 更新了随机字符串生成部分的代码, 以优化性能.

##### 2205151252

- 更新了部分变量命名.

##### 2205151541

- 更新了日志规则与视觉效果.

#### 2205151906

- 实现了下发验证请求中 RSA 结构体与字符串之间的相互转换. 更改了从密钥文件中读取 RSA 结构体的逻辑, 使其使用上述函数.

- 更新了信息处理函数, 使其能够访问位于 program_stat 变量中的 RSA 密钥.

##### 2205161002

- 更新了初始化 RSA 时的代码逻辑, 现在从密钥文件中读取 RSA 结构体不再要求必须传入成对的公私钥文件名, 而是可以传入单个密钥文件并指定该密钥文件的类型(公/私)以从文件中获取 RSA 结构体.

##### 2205161119

- 更新了初始化 RSA 时的代码逻辑, 现在会先从文件中尝试读取密钥, 再对密钥对进行检查.

- 更新了 RSA 功能函数库, 修复了多处由于出现异常时直接返回而未释放资源导致的内存泄露.

##### 2205161228

- 更新 Commit.md.

#### 2205161709

- 实现下发验证请求功能.

##### 2205161718

- 修复在下发验证请求处理过程中确认码未保存的问题.

### V 4.2 alpha

#### 2205171930

- 基本实现注册功能 (框架完成, 但未与存储用户信息的数据库进行交互).

- 统一服务端/客户端在实现通信功能的核心代码上的格式与风格.

##### 2205181206

- 实现注册功能与数据库之间的交互.

##### 2205190949

- 同步数据库更改, 由于密码中已包含盐值, 不再将盐值作为单独的字段进行存储.

##### 2205191048

- Update Manual.md.

##### 2205191050

- Update README.md

#### 2205191251

- 实现 REQCONF 消息对 DUPCONN 消息的兼容, 现在 REQCONF 消息会交换 token 信息, 为 DUPCONN 消息做准备.

#### 2205191504

- 实现 REGIST 消息对用户信息的初始化. 现在 REGISTER 消息会在结束时读取并初始化用户信息, 为客户端长短命令消息做准备.

- libmysql 新增功能: 读取一行或读取一列. 

#### 2205191641

- 实现登录功能.

##### 2205191653

- 修复了切换用户时, 工作目录未随之切换的问题.

#### 2205191929

- 初步实现拷贝连接功能.

  - 目前仅可在超时断连的情况下, 手动在客户端输入 dup 执行重新连接. 在已连接的情况下拷贝连接尚未实现.

  - 客户端待实现在断连情况下自动连接. 尤其注意要考虑在执行命令的过程中超时断连的情况.

  - 服务端待实现在已连接情况下的拷贝连接.

  - 服务端待实现自动清理. 目前的设想为: 超时断连放入休眠队列, 而对方主动断连则直接断开.

##### 2205201045

- 调整部分文件结构.

#### 2205201320

- 实现了拷贝连接的基本功能.

  - 客户端在使用拷贝连接功能时, 会新拉起一个连接并向服务器发出请求. 如果客户端已被断开连接, 则其会自动将新拉起的连接作为主线程通信连接使用.

  - 客户端在已断开连接的情况下执行命令时, 会在命令被执行前自动发起拷贝连接, 以恢复主线程通信环境. 该功能已向后兼容.

  - 客户端依旧可以手动发起拷贝连接. 

  - 服务端在接收到拷贝连接请求时, 会自动判断对端是想恢复已休眠的连接, 还是想拷贝一个现有的连接, 并根据判断结果, 从已休眠连接链表或现有连接哈希表中恢复该连接的工作环境.

  - 客户端主动断开时, 服务器会直接将该连接直接清除. 只有在服务端超时自动断开客户端连接时, 才会将该连接放入休眠队列.

  - 服务端的自动(或定时)清理尚未实现.

- 客户端将 program_stat 指针作为全局变量处理, 不再将其在函数之间传递. 所有涉及到以 program_stat 为参数的函数均做有相应调整.

##### 2205201846

- 修改了部分变量名, 同步数据库字段更新.